<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#0A1628">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Naskh+Arabic:wght@400;700&family=Almarai:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <title>Car Showroom Manager - Ultimate Edition</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #0A1628 0%, #1E3A5F 50%, #2C5F8D 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }
        body.urdu {
            direction: rtl;
            text-align: right;
            font-family: 'Noto Naskh Arabic', 'Almarai', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        }
        body.urdu input, body.urdu select { text-align: right; direction: rtl; }
        body.urdu .tab-buttons { flex-direction: row-reverse; }
        body.urdu label { text-align: right; }
        body.urdu .radio-group { flex-direction: row-reverse; }
        
        .text-en { display: inline; }
        .text-ur { display: none; }
        body.urdu .text-en { display: none; }
        body.urdu .text-ur { display: inline; }
        
        .icon { display: inline-block; margin-right: 6px; }
        body.urdu .icon { margin-right: 0; margin-left: 6px; }
        
        .profit-icon { color: #28a745 !important; }
        
        body::before {
            content: ''; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background-image: radial-gradient(circle at 20% 50%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
            radial-gradient(circle at 80% 80%, rgba(107, 70, 193, 0.1) 0%, transparent 50%);
            pointer-events: none; z-index: 0;
        }
        .container { max-width: 600px; margin: 0 auto; position: relative; z-index: 1; }
        .login-container {
            background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(20px); padding: 40px;
            border-radius: 24px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .login-container h1 {
            background: linear-gradient(135deg, #0A1628 0%, #00D4FF 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
            font-size: 28px; font-weight: 800; margin-bottom: 10px;
        }
        .header {
            background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(20px); padding: 24px;
            border-radius: 20px; margin-bottom: 20px; text-align: center; border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .header h1 {
            background: linear-gradient(135deg, #0A1628 0%, #00D4FF 100%);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
            font-size: 26px; font-weight: 800; margin-bottom: 8px;
        }
        .logout-btn {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white; border: none; padding: 10px 20px; border-radius: 12px;
            font-size: 13px; font-weight: 600; cursor: pointer; margin-top: 12px; margin-left: 8px;
            display: inline-flex; align-items: center; gap: 6px;
        }
        body.urdu .logout-btn { margin-left: 0; margin-right: 8px; }
        .manage-btn { background: linear-gradient(135deg, #00D4FF 0%, #6B46C1 100%); }
        .card {
            background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(20px); padding: 24px;
            border-radius: 20px; margin-bottom: 20px; min-height: calc(100vh - 200px); 
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .tab-buttons {
            display: flex; gap: 6px; background: rgba(255, 255, 255, 0.98); backdrop-filter: blur(20px);
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); padding: 12px;
            z-index: 100; max-width: 560px; width: calc(100% - 40px); border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .tab-btn {
            flex: 1; padding: 12px 8px; border: none; background: transparent; color: #666;
            border-radius: 14px; font-size: 11px; font-weight: 700; cursor: pointer;
            display: flex; flex-direction: column; align-items: center; gap: 6px;
        }
        .tab-btn.active {
            background: linear-gradient(135deg, #00D4FF 0%, #6B46C1 100%);
            color: white; transform: translateY(-2px);
        }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .form-group { margin-bottom: 18px; }
        label { display: block; margin-bottom: 8px; color: #2C3E50; font-weight: 700; font-size: 14px; }
        input[type="text"], input[type="password"], input[type="date"], input[type="number"], select {
            width: 100%; padding: 14px 16px; border: 2px solid #E8ECF0; border-radius: 12px;
            font-size: 16px; background: #F8F9FA; color: #2C3E50; font-weight: 500;
        }
        input:focus, select:focus {
            outline: none; border-color: #00D4FF; background: white;
            box-shadow: 0 0 0 4px rgba(0, 212, 255, 0.1);
        }
        input[type="radio"] { margin-right: 8px; }
        body.urdu input[type="radio"] { margin-right: 0; margin-left: 8px; }
        .radio-group { display: flex; gap: 20px; margin: 10px 0; }
        .radio-group label { display: flex; align-items: center; font-weight: normal; cursor: pointer; }
        .btn {
            width: 100%; padding: 16px; border: none; border-radius: 14px; font-size: 16px;
            font-weight: 700; cursor: pointer; margin-top: 12px; display: flex; align-items: center;
            justify-content: center; gap: 8px;
        }
        .btn-primary {
            background: linear-gradient(135deg, #00D4FF 0%, #6B46C1 100%);
            color: white;
        }
        .btn-primary:hover { transform: translateY(-3px); }
        .success-msg, .error-msg {
            padding: 14px 18px; border-radius: 12px; margin-bottom: 16px; display: none;
            font-weight: 600;
        }
        .success-msg {
            background: linear-gradient(135deg, #d4edda 0%, #c3e6cb 100%);
            color: #155724; border-left: 4px solid #28a745;
        }
        body.urdu .success-msg { border-left: none; border-right: 4px solid #28a745; }
        .error-msg {
            background: linear-gradient(135deg, #f8d7da 0%, #f5c6cb 100%);
            color: #721c24; border-left: 4px solid #dc3545;
        }
        body.urdu .error-msg { border-left: none; border-right: 4px solid #dc3545; }
        .hidden { display: none !important; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(10, 22, 40, 0.98); z-index: 1000; padding: 20px; overflow-y: auto;
        }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .close-modal {
            position: absolute; top: -50px; right: 0;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border: none; padding: 12px 24px; border-radius: 12px; font-size: 16px;
            font-weight: 700; cursor: pointer; display: inline-flex; align-items: center; gap: 6px;
        }
    </style>
</head>
<body>
    <div id="login-screen" class="container">
        <div class="login-container">
            <h1>ğŸš— <span class="text-en">CAR SHOWROOM MANAGER</span><span class="text-ur">Ú©Ø§Ø± Ø´Ùˆ Ø±ÙˆÙ… Ù…ÛŒÙ†ÛŒØ¬Ø±</span></h1>
            <p><span class="text-en">Premium Sales Management System</span><span class="text-ur">Ù¾Ø±ÛŒÙ…ÛŒÙ… Ø³ÛŒÙ„Ø² Ù…ÛŒÙ†Ø¬Ù…Ù†Ù¹ Ø³Ø³Ù¹Ù…</span></p>
            <div style="margin-top: 30px;">
                <div class="error-msg" id="login-error"></div>
                <div class="form-group">
                    <label><span class="text-en">Password</span><span class="text-ur">Ù¾Ø§Ø³ ÙˆØ±Úˆ</span></label>
                    <input type="password" id="login-password" placeholder="Enter password">
                </div>
                <button class="btn btn-primary" onclick="login()"><span class="icon">ğŸ”“</span> <span class="text-en">Login</span><span class="text-ur">Ù„Ø§Ú¯ Ø§Ù†</span></button>
            </div>
        </div>
    </div>

    <div id="main-app" class="container hidden">
        <div class="header">
            <h1>ğŸš— <span class="text-en">CAR SHOWROOM MANAGER</span><span class="text-ur">Ú©Ø§Ø± Ø´Ùˆ Ø±ÙˆÙ… Ù…ÛŒÙ†ÛŒØ¬Ø±</span></h1>
            <button class="logout-btn" onclick="toggleLanguage()" style="background: linear-gradient(135deg, #D4AF37 0%, #FFD700 100%);">
                <span class="icon">ğŸŒ</span> <span class="text-en">Ø§Ø±Ø¯Ùˆ</span><span class="text-ur">English</span>
            </button>
            <button class="logout-btn manage-btn" onclick="manageEmployees()"><span class="icon">ğŸ‘¥</span> <span class="text-en">Employees</span><span class="text-ur">Ù…Ù„Ø§Ø²Ù…ÛŒÙ†</span></button>
            <button class="logout-btn" onclick="logout()"><span class="icon">ğŸšª</span> <span class="text-en">Logout</span><span class="text-ur">Ù„Ø§Ú¯ Ø¢Ø¤Ù¹</span></button>
        </div>

        <div class="card">
            <div id="upload-tab" class="tab-content active">
                <div class="success-msg" id="upload-success"></div>
                <div class="error-msg" id="upload-error"></div>
                <div class="form-group">
                    <label><span class="text-en">Car Name/Model *</span><span class="text-ur">Ú¯Ø§Ú‘ÛŒ Ú©Ø§ Ù†Ø§Ù…/Ù…Ø§ÚˆÙ„ *</span></label>
                    <input type="text" id="car-name" placeholder="e.g., Toyota Corolla 2020">
                </div>
                <div class="form-group">
                    <label><span class="text-en">Car Registration Number *</span><span class="text-ur">Ø±Ø¬Ø³Ù¹Ø±ÛŒØ´Ù† Ù†Ù…Ø¨Ø± *</span></label>
                    <input type="text" id="reg-number" placeholder="e.g., ABC-123" style="text-transform: uppercase;">
                </div>
                <div class="form-group">
                    <label><span class="text-en">Customer Name *</span><span class="text-ur">Ú¯Ø§ÛÚ© Ú©Ø§ Ù†Ø§Ù… *</span></label>
                    <input type="text" id="customer-name" placeholder="e.g., Ahmed Khan">
                </div>
                <div class="form-group">
                    <label><span class="text-en">Customer Phone *</span><span class="text-ur">Ú¯Ø§ÛÚ© Ú©Ø§ ÙÙˆÙ† *</span></label>
                    <input type="text" id="customer-phone" placeholder="e.g., 03001234567">
                </div>
                <div class="form-group">
                    <label><span class="text-en">Selling Date *</span><span class="text-ur">ÙØ±ÙˆØ®Øª Ú©ÛŒ ØªØ§Ø±ÛŒØ® *</span></label>
                    <input type="date" id="selling-date">
                </div>
                <div class="form-group">
                    <label><span class="text-en">Selling Price (PKR) *</span><span class="text-ur">ÙØ±ÙˆØ®Øª Ú©ÛŒ Ù‚ÛŒÙ…Øª (PKR) *</span></label>
                    <input type="number" id="selling-price" placeholder="e.g., 2500000" min="0" step="1000">
                </div>
                <div class="form-group">
                    <label><span class="text-en">Purchase Cost (PKR) *</span><span class="text-ur">Ø®Ø±ÛŒØ¯Ø§Ø±ÛŒ Ú©ÛŒ Ù‚ÛŒÙ…Øª (PKR) *</span></label>
                    <input type="number" id="purchase-cost" placeholder="e.g., 2000000" min="0" step="1000">
                </div>
                <div class="form-group">
                    <label><span class="text-en">Payment Type *</span><span class="text-ur">Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒ Ú©ÛŒ Ù‚Ø³Ù… *</span></label>
                    <div class="radio-group">
                        <label><input type="radio" name="payment-type" value="CASH" checked> <span class="icon">ğŸ’µ</span> <span class="text-en">Cash</span><span class="text-ur">Ù†Ù‚Ø¯</span></label>
                        <label><input type="radio" name="payment-type" value="INSTALLMENT"> <span class="icon">ğŸ“…</span> <span class="text-en">Installment</span><span class="text-ur">Ù‚Ø³Ø·ÛŒÚº</span></label>
                    </div>
                </div>
                <div class="form-group">
                    <label><span class="text-en">Sold By (Employee) *</span><span class="text-ur">ÙØ±ÙˆØ®Øª Ú©Ù†Ù†Ø¯Û *</span></label>
                    <select id="sold-by">
                        <option value=""><span class="text-en">Select</span></option>
                    </select>
                </div>
                <div class="form-group">
                    <label><span class="text-en">Receipt Photo *</span><span class="text-ur">Ø±Ø³ÛŒØ¯ Ú©ÛŒ ØªØµÙˆÛŒØ± *</span></label>
                    <input type="file" id="receipt-photo" accept="image/*">
                </div>
                <button class="btn btn-primary" onclick="uploadReceipt()"><span class="icon">ğŸ’¾</span> <span class="text-en">Save Receipt</span><span class="text-ur">Ø±Ø³ÛŒØ¯ Ù…Ø­ÙÙˆØ¸ Ú©Ø±ÛŒÚº</span></button>
            </div>

            <div id="payments-tab" class="tab-content">
                <h3 style="color: #00D4FF; margin-bottom: 20px; font-weight: 800;"><span class="icon">ğŸ’°</span> <span class="text-en">Payments</span><span class="text-ur">Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒØ§Úº</span></h3>
                <div id="payments-list"></div>
            </div>

            <div id="search-tab" class="tab-content">
                <div class="form-group">
                    <label><span class="text-en">Search by Reg Number</span><span class="text-ur">ØªÙ„Ø§Ø´ Ú©Ø±ÛŒÚº</span></label>
                    <input type="text" id="search-input" placeholder="ABC-123" style="text-transform: uppercase;">
                </div>
                <button class="btn btn-primary" onclick="performSearch()"><span class="icon">ğŸ”</span> <span class="text-en">Search</span><span class="text-ur">ØªÙ„Ø§Ø´</span></button>
                <div id="search-results"></div>
            </div>

            <div id="all-tab" class="tab-content">
                <button class="btn btn-primary" onclick="loadAllReceipts()" style="margin-bottom: 15px;"><span class="icon">ğŸ”„</span> <span class="text-en">Load Receipts</span><span class="text-ur">Ù„ÙˆÚˆ Ú©Ø±ÛŒÚº</span></button>
                <div id="all-receipts"></div>
            </div>

            <div id="profit-tab" class="tab-content">
                <h3 style="color: #00D4FF; font-weight: 800; text-align: center;"><span class="icon profit-icon">ğŸ’µ</span> <span class="text-en">Profit & Loss</span><span class="text-ur">Ù…Ù†Ø§ÙØ¹</span></h3>
                <div style="background: linear-gradient(135deg, #00D4FF 0%, #6B46C1 100%); padding: 20px; border-radius: 15px; color: white; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div><div style="font-size: 12px; opacity: 0.9;"><span class="text-en">Total Revenue</span><span class="text-ur">Ú©Ù„ Ø¢Ù…Ø¯Ù†ÛŒ</span></div>
                        <div style="font-size: 18px; font-weight: 700;" id="profit-revenue">â‚¨0</div></div>
                        <div><div style="font-size: 12px; opacity: 0.9;"><span class="text-en">Net Profit</span><span class="text-ur">Ø®Ø§Ù„Øµ Ù…Ù†Ø§ÙØ¹</span></div>
                        <div style="font-size: 18px; font-weight: 700; color: #28a745;" id="profit-net">â‚¨0</div></div>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="calculateProfit()"><span class="icon">ğŸ”„</span> <span class="text-en">Refresh</span><span class="text-ur">ØªØ§Ø²Û Ú©Ø±ÛŒÚº</span></button>
                <div id="profit-breakdown"></div>
            </div>

            <div id="analytics-tab" class="tab-content">
                <h3 style="color: #00D4FF; font-weight: 800; text-align: center;"><span class="icon">ğŸ“Š</span> <span class="text-en">Analytics</span><span class="text-ur">Ø´Ù…Ø§Ø±ÛŒØ§Øª</span></h3>
                <button class="btn btn-primary" onclick="calculateAnalytics()"><span class="icon">ğŸ”„</span> <span class="text-en">Refresh</span><span class="text-ur">ØªØ§Ø²Û Ú©Ø±ÛŒÚº</span></button>
                <div id="analytics-data"></div>
            </div>

            <div style="text-align: center; padding: 20px 0 100px 0; color: #00D4FF; font-size: 13px; font-weight: 700;">
                <span class="text-en">Created by WM with â¤ï¸</span><span class="text-ur">WM Ù†Û’ Ù…Ø­Ø¨Øª Ø³Û’ Ø¨Ù†Ø§ÛŒØ§ â¤ï¸</span>
            </div>

            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('upload')"><span style="font-size: 22px;">ğŸ“¤</span><span class="text-en">Upload</span><span class="text-ur">Ø§Ù¾ Ù„ÙˆÚˆ</span></button>
                <button class="tab-btn" onclick="switchTab('payments')"><span style="font-size: 22px;">ğŸ’°</span><span class="text-en">Payments</span><span class="text-ur">Ø§Ø¯Ø§Ø¦ÛŒÚ¯ÛŒØ§Úº</span></button>
                <button class="tab-btn" onclick="switchTab('search')"><span style="font-size: 22px;">ğŸ”</span><span class="text-en">Search</span><span class="text-ur">ØªÙ„Ø§Ø´</span></button>
                <button class="tab-btn" onclick="switchTab('all')"><span style="font-size: 22px;">ğŸ“‹</span><span class="text-en">All</span><span class="text-ur">ØªÙ…Ø§Ù…</span></button>
                <button class="tab-btn" onclick="switchTab('profit')"><span style="font-size: 22px; color: #28a745;">ğŸ’µ</span><span class="text-en">Profit</span><span class="text-ur">Ù…Ù†Ø§ÙØ¹</span></button>
                <button class="tab-btn" onclick="switchTab('analytics')"><span style="font-size: 22px;">ğŸ“Š</span><span class="text-en">Stats</span><span class="text-ur">Ø§Ø¹Ø¯Ø§Ø¯ÙˆØ´Ù…Ø§Ø±</span></button>
            </div>
        </div>
    </div>

    <div id="modal" class="modal">
        <div style="position: relative; max-width: 900px; width: 100%;">
            <button class="close-modal" onclick="closeModal()"><span class="icon">âœ•</span> <span class="text-en">Close</span><span class="text-ur">Ø¨Ù†Ø¯</span></button>
            <img id="modal-image" style="width: 100%; max-height: 85vh; object-fit: contain; border-radius: 16px;">
            <div style="text-align: center; margin-top: 15px; color: white;">
                <div style="font-size: 20px; font-weight: 700;" id="modal-reg"></div>
                <div style="font-size: 14px; margin-top: 5px;" id="modal-details"></div>
                <div style="margin-top: 15px; display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="editReceipt()" style="width: auto; padding: 10px 20px; background: linear-gradient(135deg, #D4AF37 0%, #FFD700 100%);"><span class="icon">âœï¸</span> <span class="text-en">Edit</span><span class="text-ur">ØªØ±Ù…ÛŒÙ…</span></button>
                    <button class="btn btn-primary" onclick="deleteReceipt()" style="width: auto; padding: 10px 20px; background: #dc3545;"><span class="icon">ğŸ—‘ï¸</span> <span class="text-en">Delete</span><span class="text-ur">Ø­Ø°Ù</span></button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const CONFIG = {
            PASSWORD: 'hasnain123',
            GOOGLE_SCRIPT_URL: 'https://script.google.com/macros/s/AKfycbzAaxqPHhGV9sLotNqpSLQXNliyZJyqywB31WGOUOmxRYHgF2zA8_ZDQYKqSSDk_PjDEA/exec'
        };

        let currentLang = localStorage.getItem('language') || 'en';
        let employeesList = JSON.parse(localStorage.getItem('employees')) || [];
        let allReceiptsCache = [];

        function toggleLanguage() {
            currentLang = currentLang === 'en' ? 'ur' : 'en';
            localStorage.setItem('language', currentLang);
            document.body.classList.toggle('urdu');
        }

        function loadEmployeesIntoDropdowns() {
            const select = document.getElementById('sold-by');
            const firstOption = '<option value=""><span class="text-en">Select</span><span class="text-ur">Ù…Ù†ØªØ®Ø¨ Ú©Ø±ÛŒÚº</span></option>';
            select.innerHTML = firstOption;
            employeesList.forEach(emp => {
                const option = document.createElement('option');
                option.value = emp;
                option.textContent = emp;
                select.appendChild(option);
            });
        }

        function manageEmployees() {
            const action = prompt('ğŸ‘¥ Manage Employees\n\n1ï¸âƒ£ View\n2ï¸âƒ£ Add\n3ï¸âƒ£ Remove\n\nChoice:');
            if (action === '1') {
                alert('ğŸ‘¥: ' + (employeesList.length ? employeesList.join(', ') : 'None'));
            } else if (action === '2') {
                const name = prompt('Name:');
                if (name && !employeesList.includes(name)) {
                    employeesList.push(name);
                    localStorage.setItem('employees', JSON.stringify(employeesList));
                    loadEmployeesIntoDropdowns();
                    alert('âœ… Added');
                }
            } else if (action === '3') {
                const name = prompt('Remove:', employeesList.join(', '));
                const idx = employeesList.indexOf(name);
                if (idx > -1) {
                    employeesList.splice(idx, 1);
                    localStorage.setItem('employees', JSON.stringify(employeesList));
                    loadEmployeesIntoDropdowns();
                    alert('âœ… Removed');
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            document.body.classList.toggle('urdu', currentLang === 'ur');
            loadEmployeesIntoDropdowns();
            document.getElementById('login-password').addEventListener('keyup', e => e.key === 'Enter' && login());
            document.getElementById('selling-date').valueAsDate = new Date();
        });

        function checkLogin() {
            if (sessionStorage.getItem('loggedIn') === 'true') showMainApp();
            else showLoginScreen();
        }

        function login() {
            if (document.getElementById('login-password').value === CONFIG.PASSWORD) {
                sessionStorage.setItem('loggedIn', 'true');
                showMainApp();
            } else {
                document.getElementById('login-error').textContent = 'âŒ Wrong password';
                document.getElementById('login-error').style.display = 'block';
            }
        }

        function logout() {
            sessionStorage.removeItem('loggedIn');
            showLoginScreen();
        }

        function showLoginScreen() {
            document.getElementById('login-screen').classList.remove('hidden');
            document.getElementById('main-app').classList.add('hidden');
        }

        function showMainApp() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-app').classList.remove('hidden');
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            event.target.closest('.tab-btn').classList.add('active');
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById(tab + '-tab').classList.add('active');
        }

        async function uploadReceipt() {
            const data = {
                action: 'upload',
                carName: document.getElementById('car-name').value,
                regNumber: document.getElementById('reg-number').value.toUpperCase(),
                customerName: document.getElementById('customer-name').value,
                customerPhone: document.getElementById('customer-phone').value,
                sellingDate: document.getElementById('selling-date').value,
                sellingPrice: parseFloat(document.getElementById('selling-price').value),
                purchaseCost: parseFloat(document.getElementById('purchase-cost').value),
                paymentType: document.querySelector('input[name="payment-type"]:checked').value,
                soldBy: document.getElementById('sold-by').value
            };

            try {
                const response = await fetch(CONFIG.GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify(data) });
                const result = await response.json();
                if (result.success) {
                    document.getElementById('upload-success').textContent = 'âœ… Receipt saved!';
                    document.getElementById('upload-success').style.display = 'block';
                }
            } catch (e) {
                alert('Error: ' + e.message);
            }
        }

        async function loadAllReceipts() {
            try {
                const response = await fetch(CONFIG.GOOGLE_SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'getAll' }) });
                const result = await response.json();
                if (result.success) {
                    allReceiptsCache = result.receipts || [];
                    let html = '';
                    allReceiptsCache.forEach(r => {
                        html += `<div style="padding: 15px; border: 1px solid #ccc; margin: 10px 0; border-radius: 8px; cursor: pointer;" onclick='showReceiptDetails(${JSON.stringify(r).replace(/'/g, "&#39;")})'>
                        <strong>${r.carName} (${r.regNumber})</strong><br>${r.customerName} - â‚¨${r.sellingPrice}
                        </div>`;
                    });
                    document.getElementById('all-receipts').innerHTML = html || 'No receipts';
                }
            } catch (e) {
                alert('Error loading: ' + e.message);
            }
        }

        function showReceiptDetails(receipt) {
            document.getElementById('modal-reg').textContent = receipt.carName + ' (' + receipt.regNumber + ')';
            document.getElementById('modal-details').textContent = receipt.customerName + ' - â‚¨' + receipt.sellingPrice;
            document.getElementById('modal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
        }

        function editReceipt() {
            alert('Edit feature coming soon!');
        }

        function deleteReceipt() {
            alert('Delete feature coming soon!');
        }

        async function performSearch() {
            const reg = document.getElementById('search-input').value.toUpperCase();
            let html = '';
            allReceiptsCache.filter(r => r.regNumber === reg).forEach(r => {
                html += `<div style="padding: 15px; border: 1px solid #ccc; margin: 10px 0;">${r.carName} - â‚¨${r.sellingPrice}</div>`;
            });
            document.getElementById('search-results').innerHTML = html || 'âŒ Not found';
        }

        function calculateProfit() {
            let revenue = 0, costs = 0;
            allReceiptsCache.forEach(r => {
                revenue += r.sellingPrice || 0;
                costs += r.purchaseCost || 0;
            });
            document.getElementById('profit-revenue').textContent = 'â‚¨' + revenue.toLocaleString();
            document.getElementById('profit-net').textContent = 'â‚¨' + (revenue - costs).toLocaleString();
        }

        function calculateAnalytics() {
            document.getElementById('analytics-data').innerHTML = '<div style="color: white; padding: 20px;">Total Cars: ' + allReceiptsCache.length + '</div>';
        }

        checkLogin();
    </script>
</body>
</html>
